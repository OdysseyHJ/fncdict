market_proportion,3349,,b1^eIF^pISNULL^pBIGBUYCOUNT1^b^s1^B^P^c0^cBIGBUYCOUNT1^b^s1^B^P+IF^pISNULL^pWAITBUYCOUNT1^b^s1^B^P^c0^cWAITBUYCOUNT1^b^s1^B^P^a^r^ns1^eIF^pISNULL^pBIGSELLCOUNT1^b^s1^B^P^c0^cBIGSELLCOUNT1^b^s1^B^P+IF^pISNULL^pWAITSELLCOUNT1^b^s1^B^P^c0^cWAITSELLCOUNT1^b^s1^B^P^a^r^nb2^eIF^pISNULL^pBIGBUYCOUNT2^b^s1^B^P^c0^cBIGBUYCOUNT2^b^s1^B^P+IF^pISNULL^pWAITBUYCOUNT2^b^s1^B^P^c0^cWAITBUYCOUNT2^b^s1^B^P^a^r^ns2^eIF^pISNULL^pBIGSELLCOUNT2^b^s1^B^P^c0^cBIGSELLCOUNT2^b^s1^B^P+IF^pISNULL^pWAITSELLCOUNT2^b^s1^B^P^c0^cWAITSELLCOUNT2^b^s1^B^P^a^r^npos:^e^s2^a^r^n//^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^r^nIF^pISNULL^pLV_D_SUPER_HLD_RATIO^bpos^B^P^P//控盘度、超户曲线^r^n{^r^nm^eJGCGS/^pTV_D_PUBLIC_SHARES*LV_D_SUPER_HLD_RATIO^P^a^r^nIF^pISNULL^pm^P OR m^e^e0^P m^e0.4663866413^a^r^nIF^pm>0.9^P m^e0.9^a^r^nddx:^e^p^pb1^ss1^P+^pb2^ss2^P*0.7^P/TV_D_PUBLIC_SHARES *100^a//控盘度变化^r^nddx1:^e^p^pb1^ss1^P+^pb2^ss2^P*0.7*m^P/TV_D_PUBLIC_SHARES *100^a//超户变化^r^nIF^pISNULL^pLV_D_SUPER_HLD_RATIO^P^P//判断新股^r^n{^r^nRET^e^pB1+b2^P/TV_D_PUBLIC_SHARES *100^a^r^nRET1^eB1/TV_D_PUBLIC_SHARES *100^a^r^n}^r^nELSE^r^n{^r^nX1^eLV_D_SUPER_HLD_RATIO*100^a//昨天控盘度^r^nret:^eX1+ddx^a//今天控盘度^r^nX11^eLV_D_CH_HLD_RATIO*100^a//昨天超户^r^nRet1:^eX11+ddx1^a//今天超户^r^n//^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s控盘度，超户同步调整^r^nIF^pddx > 0^P//增加，控盘度调整，超户同步调整^r^n{^r^nIF^px1>95^P^r^n{^r^nret :^e x1+ddx*0.1^a^r^nRet1 :^e x11+ddx1*0.1^a^r^n}^r^nELSE IF^px1>90^P^r^n{^r^nret :^e x1+ddx*0.5^a^r^nRet1 :^e x11+ddx1*0.5^a^r^n}^r^nELSE IF^px1>85^P^r^n{^r^nret :^e x1+ddx*0.8^a^r^nRet1 :^e x11+ddx1*0.8^a^r^n}^r^n}^r^nIF^pddx < 0 ^P//减少，控盘度调整，超户同步^r^n{^r^nIF^px1<5^P^r^n{^r^nret :^e x1+ddx*0.1^a^r^nRet1 :^e x11+ddx1*0.1^a^r^n}^r^nELSE IF^px1<10^P^r^n{^r^nret :^e x1+ddx*0.5^a^r^nRet1 :^e x11+ddx1*0.5^a^r^n}^r^nELSE IF^px1<15^P^r^n{^r^nret :^e x1+ddx*0.8^a^r^nRet1 :^e x11+ddx1*0.8^a^r^n}^r^n}^r^n}^r^n//^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s控盘度超户绝对值调整^r^nIF^pISNULL^pret^P^P^r^nret :^e LV_D_SUPER_HLD_RATIO*100^a^r^nIF^pISNULL^pret1^P^P^r^nRet1 :^e LV_D_CH_HLD_RATIO*100^a^r^nIF^pret > 97.18^P^r^nret :^e 97.18^a^r^nIF^pret < 2.08^P^r^nret :^e 2.08^a^r^nIF^pret1 > 96^P^r^nRet1 :^e 96^a^r^nIF^pret1 < 0^P^r^nRet1 :^e0^a^r^n}^r^nELSE^r^n{^r^nret^eLV_D_SUPER_HLD_RATIO*100^a^r^nRet1^eLV_D_CH_HLD_RATIO*100^a^r^n}^r^n//^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s大户持仓比^r^nret2^eret^sret1^a^r^n//^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s中户持仓比^r^nA3^e100^sret^a//a为实时的散户持仓比例^r^nIF^pISNULL^pLV_D_ZH_HLD_RATIO^bpos^B^P^P^r^n{^r^nDY^eLV_D_ZH_HLD_RATIO^a//日中户持股占比^r^nBB1^e BIGBUYCOUNT3^a//主动中单买入股数^r^nSS1^eBIGSELLCOUNT3^a//主动中单卖出股数^r^nBB2^e WAITBUYCOUNT3^a//被动中单买入股数^r^nSS2^e WAITSELLCOUNT3^a//被动中单卖出股数^r^nZZ1^e^p BB1+ BB2^s SS1^s SS2^P^a//当天中户净买入股数^r^nZZ2^e^p BB1+ BB2^s SS1^s SS2^P/ TV_D_PUBLIC_SHARES *100^a//当天中户净买入占比^r^nIF^pISNULL^pLV_D_ZH_HLD_RATIO^P^P^r^n{^r^nRET3^e^pBB1+BB2^P/TV_D_PUBLIC_SHARES *100^a^r^n}^r^nELSE^r^n{^r^nXX1^eDY *100^a^r^nRet3:^eXX1+^pZZ1/TV_D_PUBLIC_SHARES*100^P^a^r^nIF^pZZ2>^e0^P^r^n{^r^nIF ^p XX1>0.9*a3^P//a是实时的原散户持仓比^r^nRET3^eXX1+ZZ2*0.1^a^r^nELSE IF ^pXX1>0.85*a3^P^r^nRET3^eXX1+ZZ2*0.5^a^r^n}^r^nIF^pZZ2< 0^P^r^n{^r^nIF ^pXX1<0.05*a3^P^r^nRET3^eXX1+ZZ2*0.1^a^r^nELSE IF ^pXX1<0.1*a3^P^r^nRET3^eXX1+ZZ2*0.5^a^r^n}^r^n}^r^nIF ^pret3 > 0.95*a3^P ret3^e0.95 *a3^a^r^nIF ^pret3 < 0.02*a3^P ret3^e0.02 *a3^a^r^n}^r^nELSE^r^n{^r^nRet3^e LV_D_ZH_HLD_RATIO *100^a^r^n}^r^n//^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s^s输出^r^n^r^n^r^nIF^pISNULL^pLV_D_SUPER_HLD_RATIO^P^e^e0^P^r^nCJZPB:ret1^a^r^nIF^pISNULL^pLV_D_SUPER_HLD_RATIO^P^e^e0^P^r^nJGZPB:ret2^a^r^nIF^pISNULL^pLV_D_SUPER_HLD_RATIO^P^e^e0^P^r^nZHZPB:ret3^a^r^nDRAWICON^p^pTV_D_PUBLIC_SHARES>1.05*TV_D_PUBLIC_SHARES^b1^B OR^r^nTV_D_PUBLIC_SHARES<0.95*TV_D_PUBLIC_SHARES^b1^B^P^cMA^pret^c20^P^c"kaka"^P^a^r^nSHZPB:100^sret1^sret2^sret3^a,2147430400;